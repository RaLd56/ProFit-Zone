{% extends 'main/layout.html' %}
{% load static %}
{% load product_tags %}

{% block title %}
    {{ product.name }}
{% endblock %}

{% block content %}
<style>
    .container {
    max-width: 1200px;
    margin: 0 auto;
}

.img-fluid {
    max-width: 100%;
    height: auto;
    object-fit: cover;
}

.row {
    display: flex;
    align-items: flex-start;
}

.col-md-5 {
    flex: 1;
    margin-right: 20px;
}

.col-md-7 {
    flex: 2;
}

</style>
<div class="container mt-5">
    <div class="row">
        <!-- Изображение товара -->
        <div class="col-md-6">
            <img src="{% if product.img %}{{ product.img.url }}{% else %}{% static 'images/default-product.jpg' %}{% endif %}" alt="{{ product.name }}" class="img-fluid">
        </div>

        <!-- Информация о товаре -->
        <div class="col-md-6">
            <h1>{{ product.name }}</h1>
            <p class="text-muted">{{ product.description }}</p>
            <h4>Цена: {{ product.price }} ₽</h4>
            
            <hr>

            <!-- Специфические характеристики в зависимости от типа товара -->
            <h5>Характеристики:</h5>
            <ul>
                {% if product|instanceof:"SwedishWall" %}
                    <li><strong>Комплектация:</strong> {{ product.in_bundle }}</li>
                    <li><strong>Тип установки:</strong> {{ product.installation_type }}</li>
                    <li><strong>Максимальная нагрузка:</strong> {{ product.max_load }}</li>
                    <li><strong>Диаметр перекладины:</strong> {{ product.bar_diameter }}</li>
                    <li><strong>Гарантия:</strong> {{ product.warranty }}</li>
                {% elif product|instanceof:"HorizontalBar" %}
                    <li><strong>Комплектация:</strong> {{ product.in_bundle }}</li>
                    <li><strong>Тип установки:</strong> {{ product.installation_type }}</li>
                    <li><strong>Максимальная нагрузка:</strong> {{ product.max_load }}</li>
                    <li><strong>Диаметр перекладины:</strong> {{ product.bar_diameter }}</li>
                    <li><strong>Гарантия:</strong> {{ product.warranty }}</li>
                {% elif product|instanceof:"Nutrition" %}
                    <li><strong>Категория:</strong> {{ product.category }}</li>
                    <li><strong>Калории:</strong> {{ product.calories }} ккал</li>
                    <li><strong>Белки:</strong> {{ product.protein }} г</li>
                    <li><strong>Углеводы:</strong> {{ product.carbohydrates }} г</li>
                    <li><strong>Жиры:</strong> {{ product.fats }} г</li>
                    <li><strong>Размер порции:</strong> {{ product.serving_size }}</li>
                    <li><strong>Вкус:</strong> {{ product.flavor }}</li>
                {% elif product|instanceof:"WeightliftingProduct" %}
                    <li><strong>Категория:</strong> {{ product.category }}</li>
                    <li><strong>Вес:</strong> {{ product.weight }} кг</li>
                    <li><strong>Материал:</strong> {{ product.material }}</li>
                {% elif product|instanceof:"BarbellRack" %}
                    <li><strong>Категория:</strong> Стойки для штанги</li>
                    <li><strong>Максимальная нагрузка:</strong> {{ product.max_load }} кг</li>
                    <li><strong>Высота:</strong> {{ product.height }} м</li>
                    <li><strong>Регулируемая высота:</strong> {% if product.adjustable %}Да{% else %}Нет{% endif %}</li>
                {% elif product|instanceof:"FitnessProduct" %}
                    <li><strong>Категория:</strong> {{ product.category }}</li>
                    <li><strong>Материал:</strong> {{ product.material }}</li>
                {% elif product|instanceof:"MartialArtsProduct" %}
                    <li><strong>Тип снаряжения:</strong> {{ product.get_category_display }}</li>
                    <li><strong>Материал:</strong> {{ product.material }}</li>
                
                {% else %}
                    <li>Нет дополнительных характеристик для этого товара.</li>
                {% endif %}
            </ul>
            {% if user.is_authenticated %}
            <button class="add-to-cart-btn" data-product-id="{{ product.id }}">В корзину</button>
            {% else %}
            <h3>Войдите, чтобы купить</h3>
            {% endif %}
        </div>
    </div>
</div>
<script>
    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            const quantity = 1; 
            fetch('/add-to-cart/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: new URLSearchParams({
                    'product_id': productId,
                    'quantity': quantity,
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Товар добавлен в корзину!');
                    // Можно обновить количество товаров в корзине на странице
                    document.querySelector('#cart-count').innerText = data.cart_quantity;
                } else {
                    alert('Ошибка: ' + data.message);
                }
            })
            .catch(error => console.error('Ошибка:', error));
        });
    });
</script>
{% endblock %}
